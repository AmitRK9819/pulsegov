events {
    worker_connections 1024;
}

http {
    upstream complaint_service {
        server complaint-service:3001;
    }

    upstream routing_engine {
        server routing-engine:3002;
    }

    upstream sla_tracker {
        server sla-tracker:3003;
    }

    upstream notification_service {
        server notification-service:3004;
    }

    upstream ai_classifier {
        server ai-classifier-service:8001;
    }

    upstream resolution_intelligence {
        server resolution-intelligence:8002;
    }

    server {
        listen 80;
        
        # Complaint Service
        location /api/complaints {
            proxy_pass http://complaint_service;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }

        # Routing Engine
        location /api/routing {
            proxy_pass http://routing_engine;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
        }

        # SLA Tracker
        location /api/sla {
            proxy_pass http://sla_tracker;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
        }

        # Notification Service
        location /api/notifications {
            proxy_pass http://notification_service;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
        }

        # AI Classifier
        location /api/classify {
            proxy_pass http://ai_classifier;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
        }

        # Resolution Intelligence
        location /api/resolution {
            proxy_pass http://resolution_intelligence;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
        }

        # WebSocket support
        location /ws {
            proxy_pass http://complaint_service;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
    }
}
